{"version":3,"file":"index.esm.js","sources":["../src/useAbortable.js","../src/useCleanup.js","../src/useEventListener.js","../src/useAnimationFrame.js","../src/index.js"],"sourcesContent":["// @flow\n//\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { useState, useEffect } from \"react\";\n\n// https://github.com/flow-typed/flow-typed/issues/1652\ndeclare interface AbortSignal extends EventTarget {\n  +aborted: boolean;\n  onabort: EventHandler;\n}\ndeclare class AbortController {\n  +signal: AbortSignal;\n  abort: () => void;\n}\n\n// A react hook which can be used to load async, disposable resources\n// and fire the cleanup callback when the component unmounts.\n// If the component unmounts before the async operation completes the\n// resource will still be cleaned up once it finishes loading and an\n// abort signal will be issued to the async load operation.\nexport default function useAbortable<T>(\n  defaultValue: T,\n  action: (AbortController) => Promise<T>,\n  cleanup: (?T) => void,\n  args: any\n): [T, () => void] {\n  const [result, setResult] = useState<T>(defaultValue);\n  let controller;\n  useEffect(() => {\n    controller = new AbortController();\n    const promise = action(controller).then((result: T) => {\n      // If we're aborted don't set the result into state.\n      // The cleanup will be called when the component unmounts.\n      if (!controller.signal.aborted) {\n        setResult(result);\n      }\n      return result;\n    });\n    return () => {\n      setResult(defaultValue);\n      // on unmount or args changing clean up the old value\n      promise.then(cleanup);\n      controller.abort();\n    };\n  }, args);\n  return [result, () => controller.abort()];\n}\n","// @flow\n//\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { useEffect } from \"react\";\n\n// A small React hook to fire the cleanup callback when the component unmounts.\nexport default function useCleanup(teardown: () => void): void {\n  useEffect(() => {\n    return () => {\n      teardown();\n    };\n  }, []);\n}\n","// @flow\n//\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { useEffect } from \"react\";\n\n// for adding and automatically removing event listeners\nexport default function useEventListener(\n  target: Element,\n  type: string,\n  enable: boolean,\n  handler: (any) => void,\n  dependencies: any[]\n) {\n  useEffect(\n    () => {\n      if (enable) {\n        target.addEventListener(type, handler);\n        return () => target.removeEventListener(type, handler);\n      }\n    },\n    [target, type, enable, ...dependencies]\n  );\n}\n","// @flow\n//\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { useRef, useEffect } from \"react\";\n\n// A React hook that accepts a callback function which will be called before each animation frame.\nexport default function useAnimationFrame(\n  callback: (timestamp: number) => void,\n  disable: boolean,\n  dependencies: any[]\n): void {\n  // persist the requestAnimationFrameId so the last refresh callback can be cancelled when component unmounts\n  const rafId = useRef();\n  // start the loop when the component mounts and cancel the animation frame when unmounts\n  // or related dependency changes\n  function createAnimationFrame(callback) {\n    rafId.current = requestAnimationFrame((timestamp) => {\n      createAnimationFrame(callback);\n      return callback(timestamp);\n    });\n  }\n\n  useEffect(\n    () => {\n      if (!disable) {\n        createAnimationFrame(callback);\n      }\n      return function cleanup() {\n        if (rafId.current) {\n          cancelAnimationFrame(rafId.current);\n        }\n      };\n    },\n    [callback, disable, ...dependencies]\n  );\n}\n","//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nexport { default as useAbortable } from \"./useAbortable\";\nexport { default as useCleanup } from \"./useCleanup\";\nexport { default as useEventListener } from \"./useEventListener\";\nexport { default as useAnimationFrame } from \"./useAnimationFrame\";\n"],"names":["useAbortable","defaultValue","action","cleanup","args","result","setResult","useState","controller","useEffect","AbortController","promise","then","signal","aborted","abort","useCleanup","teardown","useEventListener","target","type","enable","handler","dependencies","addEventListener","removeEventListener","useAnimationFrame","callback","disable","rafId","useRef","createAnimationFrame","current","requestAnimationFrame","timestamp","cancelAnimationFrame"],"mappings":";;AACA;AACA;;;;;;AAuBA,AAAe,SAASA,YAAT,CACbC,YADa,EAEbC,MAFa,EAGbC,OAHa,EAIbC,IAJa,EAKI;QACX,CAACC,MAAD,EAASC,SAAT,IAAsBC,QAAQ,CAAIN,YAAJ,CAApC;MACIO,UAAJ;EACAC,SAAS,CAAC,MAAM;IACdD,UAAU,GAAG,IAAIE,eAAJ,EAAb;UACMC,OAAO,GAAGT,MAAM,CAACM,UAAD,CAAN,CAAmBI,IAAnB,CAAyBP,MAAD,IAAe;;;UAGjD,CAACG,UAAU,CAACK,MAAX,CAAkBC,OAAvB,EAAgC;QAC9BR,SAAS,CAACD,MAAD,CAAT;;;aAEKA,MAAP;KANc,CAAhB;WAQO,MAAM;MACXC,SAAS,CAACL,YAAD,CAAT,CADW;;MAGXU,OAAO,CAACC,IAAR,CAAaT,OAAb;MACAK,UAAU,CAACO,KAAX;KAJF;GAVO,EAgBNX,IAhBM,CAAT;SAiBO,CAACC,MAAD,EAAS,MAAMG,UAAU,CAACO,KAAX,EAAf,CAAP;;;ACjDF;AACA;AASA,AAAe,SAASC,UAAT,CAAoBC,QAApB,EAAgD;EAC7DR,SAAS,CAAC,MAAM;WACP,MAAM;MACXQ,QAAQ;KADV;GADO,EAIN,EAJM,CAAT;;;ACXF;AACA;AASA,AAAe,SAASC,gBAAT,CACbC,MADa,EAEbC,IAFa,EAGbC,MAHa,EAIbC,OAJa,EAKbC,YALa,EAMb;EACAd,SAAS,CACP,MAAM;QACAY,MAAJ,EAAY;MACVF,MAAM,CAACK,gBAAP,CAAwBJ,IAAxB,EAA8BE,OAA9B;aACO,MAAMH,MAAM,CAACM,mBAAP,CAA2BL,IAA3B,EAAiCE,OAAjC,CAAb;;GAJG,EAOP,CAACH,MAAD,EAASC,IAAT,EAAeC,MAAf,EAAuB,GAAGE,YAA1B,CAPO,CAAT;;;ACjBF;AACA;AASA,AAAe,SAASG,iBAAT,CACbC,QADa,EAEbC,OAFa,EAGbL,YAHa,EAIP;;QAEAM,KAAK,GAAGC,MAAM,EAApB,CAFM;;;WAKGC,oBAAT,CAA8BJ,QAA9B,EAAwC;IACtCE,KAAK,CAACG,OAAN,GAAgBC,qBAAqB,CAAEC,SAAD,IAAe;MACnDH,oBAAoB,CAACJ,QAAD,CAApB;aACOA,QAAQ,CAACO,SAAD,CAAf;KAFmC,CAArC;;;EAMFzB,SAAS,CACP,MAAM;QACA,CAACmB,OAAL,EAAc;MACZG,oBAAoB,CAACJ,QAAD,CAApB;;;WAEK,SAASxB,OAAT,GAAmB;UACpB0B,KAAK,CAACG,OAAV,EAAmB;QACjBG,oBAAoB,CAACN,KAAK,CAACG,OAAP,CAApB;;KAFJ;GALK,EAWP,CAACL,QAAD,EAAWC,OAAX,EAAoB,GAAGL,YAAvB,CAXO,CAAT;;;AC3BF;;;;"}